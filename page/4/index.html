<!DOCTYPE html>





<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    search: {
      root: '/',
      path: ''
    },
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>

  <meta name="description" content="Do one thing at a time, and do well.">
<meta property="og:type" content="website">
<meta property="og:title" content="Noob">
<meta property="og:url" content="http://jeffzzf.github.io/page/4/index.html">
<meta property="og:site_name" content="Noob">
<meta property="og:description" content="Do one thing at a time, and do well.">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Noob">
<meta name="twitter:description" content="Do one thing at a time, and do well.">
  <link rel="canonical" href="http://jeffzzf.github.io/page/4/">


<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Noob</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Noob</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
    <ul id="menu" class="menu">
        
        
        
          
          <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
    </ul>
    

</nav>

</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jeffzzf.github.io/2019/07/19/Java集合总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffzzf">
      <meta itemprop="description" content="Do one thing at a time, and do well.">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Noob">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/19/Java集合总结/" class="post-title-link" itemprop="url">Java集合总结</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-19 08:44:00" itemprop="dateCreated datePublished" datetime="2019-07-19T08:44:00+08:00">2019-07-19</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-28 20:23:34" itemprop="dateModified" datetime="2019-08-28T20:23:34+08:00">2019-08-28</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Java/Collections/" itemprop="url" rel="index"><span itemprop="name">Collections</span></a></span>

                
                
              
            </span>
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h2 id="PriorityQueue"><a href="#PriorityQueue" class="headerlink" title="PriorityQueue"></a>PriorityQueue</h2><p>PriqorityQueue（优先队列）基于二叉小顶堆实现，可以用一颗完全二叉树来表示，底层采用数组来实现</p>
<p>假设树中父节点和左右子节点在数组中的下标分别为<code>parent</code>、<code>left</code>、<code>right</code>，树中任一节点对应数组下标为<code>node</code>，则有：</p>
<p><code>left=parent * 2 + 1</code></p>
<p><code>right=parent * 2 + 2</code></p>
<p><code>parent=(node - 1) / 2</code></p>
<p>PriorityQueue不允许插入<code>null</code>元素，否则将抛出<code>npe</code>异常，</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a href="https://www.cnblogs.com/CarpenterLee/p/5488070.html" target="_blank" rel="noopener">PriorityQueue</a></li>
<li><a href="https://www.cnblogs.com/CarpenterLee/p/5488070.html" target="_blank" rel="noopener">用PriorityQueue实现最大最小堆</a></li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jeffzzf.github.io/2019/07/11/Lucene原理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffzzf">
      <meta itemprop="description" content="Do one thing at a time, and do well.">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Noob">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/11/Lucene原理/" class="post-title-link" itemprop="url">Lucene查询原理</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-11 15:29:16" itemprop="dateCreated datePublished" datetime="2019-07-11T15:29:16+08:00">2019-07-11</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-28 20:23:34" itemprop="dateModified" datetime="2019-08-28T20:23:34+08:00">2019-08-28</time>
              </span>
            
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            
          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jeffzzf.github.io/2019/07/11/Es分布式原理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffzzf">
      <meta itemprop="description" content="Do one thing at a time, and do well.">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Noob">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/11/Es分布式原理/" class="post-title-link" itemprop="url">Es分布式原理</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-11 15:28:09" itemprop="dateCreated datePublished" datetime="2019-07-11T15:28:09+08:00">2019-07-11</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-28 20:23:34" itemprop="dateModified" datetime="2019-08-28T20:23:34+08:00">2019-08-28</time>
              </span>
            
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            
          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jeffzzf.github.io/2019/07/10/Es 集群原理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffzzf">
      <meta itemprop="description" content="Do one thing at a time, and do well.">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Noob">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/10/Es 集群原理/" class="post-title-link" itemprop="url">Es索引原理</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-10 19:51:56" itemprop="dateCreated datePublished" datetime="2019-07-10T19:51:56+08:00">2019-07-10</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-01-06 14:58:23" itemprop="dateModified" datetime="2020-01-06T14:58:23+08:00">2020-01-06</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/存储/" itemprop="url" rel="index"><span itemprop="name">存储</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/存储/es/" itemprop="url" rel="index"><span itemprop="name">es</span></a></span>

                
                
              
            </span>
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h2 id="Es-集群构成"><a href="#Es-集群构成" class="headerlink" title="Es 集群构成"></a>Es 集群构成</h2><p>Es 集群由多个节点（Node）构成，Node可以有不同的类型，通过以下配置可以产生四种不同类型的 Node：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">conf/elasticsearch.yml:</span></span><br><span class="line">    <span class="string">node.master:</span> <span class="literal">true</span><span class="string">/false</span></span><br><span class="line">    <span class="string">node.data:</span> <span class="literal">true</span><span class="string">/false</span></span><br></pre></td></tr></table></figure>

<p>四种不同类型的Node是一个node.master和node.data的true/false的两两组合。当然还有其他类型的Node，比如IngestNode(用于数据预处理等)，不在本文讨论范围内。</p>
<p>当node.master 为 true 时，表示这个 node 是一个 master 的候选节点，可以参与选举，类似于 MasterCandidate。Es 正常工作时只能有一个 master（leader），多于 1 个时发生脑裂。</p>
<p>当 node.data 为 true 时，这个节点作为一个数据节点，会存储分配在该 node 上的 shard 数据，并负责这些 shard 的写入、查询等。</p>
<p>此外，集群内 node 都可以执行任何请求，负责将请求转发给对应的 node 进行处理。当 node.master 和 node.data 都是 false 时，这个节点可以作为一个类似 proxy 的节点，接受请求并进行转发、结果聚合等。</p>
<h3 id="Es-选主"><a href="#Es-选主" class="headerlink" title="Es 选主"></a>Es 选主</h3><p>ZenDiscovery是ES自己实现的一套用于节点发现和选主等功能的模块，没有依赖Zookeeper等工具</p>
<p>在本节点到每个hosts中的节点建立一条边，当整个集群所有的node形成一个联通图时，所有节点都可以知道集群中有哪些节点，不会形成孤岛。</p>
<p>为了避免产生脑裂，ES采用了常见的分布式系统思路，保证选举出的master被多数派(quorum)的master-eligible node认可，以此来保证只有一个master。这个quorum通过以下配置进行配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conf/elasticsearch.yml:</span><br><span class="line">    discovery.zen.minimum_master_nodes: 2</span><br></pre></td></tr></table></figure>

<p>这个配置对于整个集群非常重要。</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><a href="https://zhuanlan.zhihu.com/p/34858035" target="_blank" rel="noopener">Elasticsearch分布式一致性原理剖析(一)-节点篇</a></li>
<li><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/translog.html" target="_blank" rel="noopener">https://www.elastic.co/guide/cn/elasticsearch/guide/current/translog.html</a></li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jeffzzf.github.io/2019/07/10/Es索引原理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffzzf">
      <meta itemprop="description" content="Do one thing at a time, and do well.">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Noob">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/10/Es索引原理/" class="post-title-link" itemprop="url">Es索引原理</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-10 19:51:56" itemprop="dateCreated datePublished" datetime="2019-07-10T19:51:56+08:00">2019-07-10</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-28 20:23:34" itemprop="dateModified" datetime="2019-08-28T20:23:34+08:00">2019-08-28</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/存储/" itemprop="url" rel="index"><span itemprop="name">存储</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/存储/es/" itemprop="url" rel="index"><span itemprop="name">es</span></a></span>

                
                
              
            </span>
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h2 id="倒排序索引的不变性"><a href="#倒排序索引的不变性" class="headerlink" title="倒排序索引的不变性"></a>倒排序索引的不变性</h2><p>es的json文档中，每个被索引的字段都有自己的倒排索引，倒排索引会保存每个词项出现过的文档总数，在对应文档中一个具体词项出现的总次数，词项在文档中的顺序，每个文档的长度，所有文档的平均长度等。这些统计信息用于计算哪些词比其它词更重要，哪些文档比其它文档更重要。</p>
<p>倒排序索引被写入磁盘后是不可变的，不可变性可以带来以下好处：</p>
<ul>
<li>不需要锁，不用担心多进程同时修改数据的问题</li>
<li>一旦索引被读入内核的文件系统缓存便会留在那里，由于不变性，大部分请求会直接请求内存而不会命中磁盘，提升性能</li>
<li>其它缓存（如filter缓存）在索引的生命周期内始终有效，不需要在每次数据改变时被重建</li>
<li>写入单个大的倒排序索引允许数据被压缩，减少磁盘I/O和需要被缓存到内存的使用量</li>
</ul>
<h2 id="倒排序索引的更新"><a href="#倒排序索引的更新" class="headerlink" title="倒排序索引的更新"></a>倒排序索引的更新</h2><p>es基于lucene，lucene引入按段搜索的概念，每一个段本身都是一个倒排索引，索引在lucene中除了表示所有段的集合外，还增加了提交点的概念——提交点是一个列出所有已知段的文件。</p>
<p>新的文档首先被添加到内存索引缓存中，然后写入到一个基于磁盘的段。当一个查询被触发，所有已知的段按顺序被查询。词项统计会对所有段的结果进行聚合，以保证每个词和每个文档的管理都被准确计算。</p>
<p>每个提交点会包含一个.del 文件，文件中会列出这些被删除文档的段信息。当一个文档被删除时，它实际只是在.del文件中被标记删除。一个被标记删除的文档仍然可以被查询匹配到，但它会在最终结果被返回前从结果集中移除。</p>
<p>文档更新时，旧版本文档被标记删除，文档的新版本被索引到一个新的段中。可能两个版本的文档都会被一个查询匹配到，但被删除的旧版本文档在结果集返回前被移除了。</p>
<h2 id="段合并"><a href="#段合并" class="headerlink" title="段合并"></a>段合并</h2><p>由于自动刷新流程每秒创建一个新的段，会导致段时间内段数量快速增长，每个段都会消耗文件句柄、内存和CPU运行周期，并且每个搜索请求都必须轮流检查每个段，所以段越多，搜索就越慢。</p>
<p>es通过段合并解决这个问题，小的段被合并到大的段，大的段被合并成更大的段。段合并时会将那些旧的已删除文档从文件系统中清除，被删除文档或被更新文档的旧版本不会被拷贝到新的大段中。合并结束后，老的段被删除。</p>
<h2 id="提高搜索性能"><a href="#提高搜索性能" class="headerlink" title="提高搜索性能"></a>提高搜索性能</h2><p>内存缓冲区中的文档会被写入到一个新的段中，新段会被先写入到文件系统缓存（代价小），稍后被刷新到磁盘（代价高）。不过只要文件已经在缓存中，就可以像其它文件一样被打开和读取了，这种方式比进行一次提交代价小得多。</p>
<p>es中写入和打开一个新段的过程叫做refresh，默认情况下，每个分片每秒自动刷新一次，文档的变化在刷新后才能被搜索到。刷新的时间间隔通过refresh_interval配置。</p>
<h2 id="事务日志"><a href="#事务日志" class="headerlink" title="事务日志"></a>事务日志</h2><p>es中的事务日志（translog）记录了所有还没被刷到磁盘的操作，当es启动时，会从磁盘中使用最后一个提交点去恢复已知的段，并且会重放translog中所有在最后一次提交发生的变更操作。</p>
<p>默认translog每5秒被fsync刷新到磁盘，或者在每次写请求完成之后执行（index、delete、update、bulk），这个过程在主分片和复制分片上都会发生，在写请求被fsync到主分片和复制分片的translog之前，客户端不会得到200 ok的响应</p>
<p>执行一次提交并截断translog的行为在es中被称作一次flush，分片每30分钟被自动刷新（flush），或者translog太大时也会刷新，可以通过配置更改这些参数。</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/dynamic-indices.html" target="_blank" rel="noopener">https://www.elastic.co/guide/cn/elasticsearch/guide/current/dynamic-indices.html</a></li>
<li><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/translog.html" target="_blank" rel="noopener">https://www.elastic.co/guide/cn/elasticsearch/guide/current/translog.html</a></li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jeffzzf.github.io/2019/07/10/Es基本用法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffzzf">
      <meta itemprop="description" content="Do one thing at a time, and do well.">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Noob">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/10/Es基本用法/" class="post-title-link" itemprop="url">Es基本用法</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-10 17:09:25" itemprop="dateCreated datePublished" datetime="2019-07-10T17:09:25+08:00">2019-07-10</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-28 20:23:34" itemprop="dateModified" datetime="2019-08-28T20:23:34+08:00">2019-08-28</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/存储/" itemprop="url" rel="index"><span itemprop="name">存储</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/存储/es/" itemprop="url" rel="index"><span itemprop="name">es</span></a></span>

                
                
              
            </span>
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h2 id="字段类型"><a href="#字段类型" class="headerlink" title="字段类型"></a>字段类型</h2><p>简单字段类型：text、keyword、date、long、double、boolean、ip</p>
<p>嵌套类型：object、nested</p>
<p>特殊类型：geo_point，geo_shape 或 completion</p>
<h2 id="动态映射"><a href="#动态映射" class="headerlink" title="动态映射"></a>动态映射</h2><p>包括动态字段映射、动态模版和索引模版</p>
<p>如果文档中有新的字段（值不为null或空数组），es会把这个字段添加到mapping中</p>
<table>
<thead>
<tr>
<th>JSON datatype</th>
<th>Elasticsearch datatype</th>
</tr>
</thead>
<tbody><tr>
<td>null</td>
<td>No field is added.</td>
</tr>
<tr>
<td>true or false</td>
<td><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/boolean.html" target="_blank" rel="noopener">boolean</a> field</td>
</tr>
<tr>
<td>floating point number</td>
<td><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/number.html" target="_blank" rel="noopener">float</a> field</td>
</tr>
<tr>
<td>integer</td>
<td><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/number.html" target="_blank" rel="noopener">long</a> field</td>
</tr>
<tr>
<td>object</td>
<td><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/object.html" target="_blank" rel="noopener">object</a> field</td>
</tr>
<tr>
<td>array</td>
<td>Depends on the first non-null value in the array.</td>
</tr>
<tr>
<td>string</td>
<td>Either a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/date.html" target="_blank" rel="noopener">date</a> field (if the value passes <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/dynamic-field-mapping.html#date-detection" target="_blank" rel="noopener">date detection</a>), a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/number.html" target="_blank" rel="noopener">double</a> or <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/number.html" target="_blank" rel="noopener">long</a>field (if the value passes <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/dynamic-field-mapping.html#numeric-detection" target="_blank" rel="noopener">numeric detection</a>) or a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/text.html" target="_blank" rel="noopener">text</a> field, with a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/keyword.html" target="_blank" rel="noopener">keyword</a>sub-field.</td>
</tr>
</tbody></table>
<p>索引模版只在创建索引时生效，修改模版不会对已创建的索引生效。使用创建索引API创建索引时，API指定的同名字段优先于模版定义的字段。</p>
<p>Lucene不理解内部对象，Lucene文档是由一组键值对列表组成的，为了能让es有效地索引内部类，它把文档转化成类似如下结构的文档</p>
<p>{</p>
<p>​    “tweet”:            [elasticsearch, flexible, very],</p>
<p>​    “user.id”:          [@johnsmith],</p>
<p>​    “user.gender”:      [male],</p>
<p>​    “user.age”:         [26],</p>
<p>​    “user.name.full”:   [john, smith],</p>
<p>​    “user.name.first”:  [john],</p>
<p>​    “user.name.last”:   [smith]</p>
<p>}</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/dynamic-mapping.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/6.4/dynamic-mapping.html</a></li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jeffzzf.github.io/2019/07/10/Es搜索过程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffzzf">
      <meta itemprop="description" content="Do one thing at a time, and do well.">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Noob">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/10/Es搜索过程/" class="post-title-link" itemprop="url">Es搜索过程</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-10 14:44:35" itemprop="dateCreated datePublished" datetime="2019-07-10T14:44:35+08:00">2019-07-10</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-01-06 14:36:39" itemprop="dateModified" datetime="2020-01-06T14:36:39+08:00">2020-01-06</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/存储/" itemprop="url" rel="index"><span itemprop="name">存储</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/存储/es/" itemprop="url" rel="index"><span itemprop="name">es</span></a></span>

                
                
              
            </span>
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h2 id="查询原理"><a href="#查询原理" class="headerlink" title="查询原理"></a>查询原理</h2><ol>
<li><h3 id="Term-查询"><a href="#Term-查询" class="headerlink" title="Term 查询"></a>Term 查询</h3><p> FST(Finite State Transducer)</p>
<p> 从 Lucene4 开始，为了实现 rangequery 或前缀、后缀等复杂的查询语句，Lucene 使用 FST 数据结构来存储 term 字典。</p>
</li>
<li><h3 id="倒排链的存储"><a href="#倒排链的存储" class="headerlink" title="倒排链的存储"></a>倒排链的存储</h3><p> 为了快速查找 docId，Lucene 采用 SkipList 数据结构，它具有以下特征：</p>
<p> A. 元素是排序的，lucene 按 docid 从小到大排序</p>
<p> B. 跳跃有固定间隔，在建立 skiplist 时指定</p>
<p> C. skiplist 的层次，指整个 skiplist 有几层</p>
</li>
<li><h3 id="倒排链合并"><a href="#倒排链合并" class="headerlink" title="倒排链合并"></a>倒排链合并</h3><p> 如果某个链很短，会大幅减少比对次数，并且由于 SkipList 结构的存在，在某个倒排中定位某个 docid 的速度会比较快不需要一个个遍历。可以很快的返回最终的结果。从倒排的定位，查询，合并整个流程组成了 lucene 的查询过程，和传统数据库的索引相比，lucene 合并过程中的优化减少了读取数据的 IO，倒排合并的灵活性也解决了传统索引较难支持多条件查询的问题。</p>
</li>
<li><h3 id="倒排链合并-1"><a href="#倒排链合并-1" class="headerlink" title="倒排链合并"></a>倒排链合并</h3><p> 如果是数值类型的范围查询，如整形、浮点型，采用 FST term 查询，潜在的 term 会非常多，查询效率很低。为了支持高效的多维数值查询，lucene 引入 BKDTree。BKDTree 基于 KDTree，对数据按照维度划分建立一棵二叉树确保树两边节点数目平衡。在一维场景下，KDTree 退化成二叉树，在二叉树中查询叶子节点对应倒排链需要 logn 时间。</p>
<p> 在多维场景下，kdtree 建立流程如下：</p>
<p> A.确定切分维度，选取顺序是数据分散越开的维度，越先切分</p>
<p> B.切分点选择维度最中间的点</p>
<p> C.递归进行 A、B，可以设置阈值，点的数据少于多少后就不再切分，直到所有的点都切分好停止    </p>
<p> BKD 是多个 KDTree 持续 merge 最终合并成一个</p>
</li>
</ol>
<h2 id="写入流程"><a href="#写入流程" class="headerlink" title="写入流程"></a>写入流程</h2><p>Es 的任意节点都可以作为协调节点（coordinating node）接受请求，通过_routing字段找到对应的 primary shard，并将请求转发给 primary shard， primary shard 完成写入后，将写入并发发送给 replica，replica 执行写入操作后返回给 primary shard，primary shard 再讲请求返回给协调节点。</p>
<h2 id="查询流程"><a href="#查询流程" class="headerlink" title="查询流程"></a>查询流程</h2><p>Es 通过分区实现分布式，数据写入时，根据 routing 规则将数据写入某个 Shard，这样能将海量数据分布在多个 Shard和多台机器上。</p>
<p>在查询时，数据可能分布在 index 的所有 Shard 中，所以需要查询所有 Shard，同一个 Shard 的 Primary 和 Replica 选择一个就可以，查询请求分发给所有 Shard，每个 Shard 中都是一个独立的查询引擎，如果需要返回 TopN 的结果，每个 Shard 都会查询返回 TopN，然后在 Client Node 中通过优先队列二次排序，找出 top N 结果返回给用户。</p>
<p>一般搜索系统都是两阶段查询，第一阶段查询到匹配的 DocId，第二阶段再查询 DocId 对应的完整文档，这种在 Es 称为 query_then_fetch，还有一种是一阶段查询返回完整 Doc，es 称为 query_and_fetch，一般第二种适用于只需要查询一个 Shard 的请求。</p>
<p>除了一阶段，两阶段外，还有一种三阶段查询的情况。搜索里面有一种算分逻辑是根据TF（Term Frequency）和DF（Document Frequency）计算基础分，但是Elasticsearch中查询的时候，是在每个Shard中独立查询的，每个Shard中的TF和DF也是独立的，虽然在写入的时候通过_routing保证Doc分布均匀，但是没法保证TF和DF均匀，那么就有会导致局部的TF和DF不准的情况出现，这个时候基于TF、DF的算分就不准。为了解决这个问题，Elasticsearch中引入了DFS查询，比如DFS_query_then_fetch，会先收集所有Shard中的TF和DF值，然后将这些值带入请求中，再次执行query_then_fetch，这样算分的时候TF和DF就是准确的，类似的有DFS_query_and_fetch。这种查询的优势是算分更加精准，但是效率会变差。另一种选择是用BM25代替TF/DF模型。</p>
<h4 id="查询阶段"><a href="#查询阶段" class="headerlink" title="查询阶段"></a>查询阶段</h4><p>在查询阶段，查询会广播到索引中的每一个分片（主分片或副本分片），每个分片在本地执行搜索并构建一个匹配文档的<strong>优先队列</strong>。一个优先队列是一个保存top-n匹配文档的有序列表，列表大小取决于分页参数from和size。</p>
<p>当一个查询请求被发送到某个节点时，这个节点即成为协调节点，它的任务是广播查询请求到所有相关分片并将它们的响应整合成全局排序后的结果集合，再将这个结果集合返回给客户端。查询请求可以被主分片或副本分片处理，协调节点在之后的查询中轮询所有分片分摊负载，所有更多的副本能够增加搜索吞吐率。分片返回一个轻量级的结果列表到协调节点，它仅包含文档id集合以及任何排序需要用到的值，如_score.</p>
<h4 id="取回阶段"><a href="#取回阶段" class="headerlink" title="取回阶段"></a>取回阶段</h4><p>查询阶段仅仅标识哪些文档满足搜索请求，获取详细文档的过程在取回阶段实现。具体步骤如下：</p>
<ol>
<li>协调节点计算出哪些文档需要被取回并向相关分片提交多个GET（multi-get request）请求</li>
<li>每个分片加载并丰富文档，并返回文档给协调节点</li>
<li>一旦所有文档都被取回了，协调节点返回结果给客户端</li>
</ol>
<h4 id="Scroll"><a href="#Scroll" class="headerlink" title="Scroll"></a>Scroll</h4><p>scroll查询可以用于查询大批量文档而不用付出深度分页的巨大代价，游标查询会取某个时间点的快照数据，时间点（查询初始化）之后的所有变化都会被忽略。它通过保存旧的数据文件来实现这个特性，就像保留初始化时的索引视图一样。</p>
<p>游标查询用<code>_doc_</code>字段来排序，这个指令让es仅从还有结果的分片返回下一批结果，可以为游标查询设置过期时间，es可以在空闲时间自动释放过期的游标查询占用的资源。scroll查询包含一个<code>_scroll_id_</code>字段，它是一个base64编码的长字符串，可以通过传递前一次查询返回的<code>_scroll_id_</code>查询下一批结果。查询时size作用于单分片，每个批次实际返回的文档数量最大为size * number_of_primary_shards.</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><p><a href="https://www.shenyanchao.cn/blog/2018/12/04/lucene-fst/" target="_blank" rel="noopener">关于Lucene的词典FST深入剖析</a></p>
</li>
<li><p><a href="https://zhuanlan.zhihu.com/p/94915597" target="_blank" rel="noopener">深入理解Elasticsearch写入过程</a></p>
</li>
<li><p><a href="https://zhuanlan.zhihu.com/p/34674517" target="_blank" rel="noopener">Elasticsearch内核解析 - 查询篇</a></p>
</li>
<li><p><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/_query_phase.html" target="_blank" rel="noopener">https://www.elastic.co/guide/cn/elasticsearch/guide/current/_query_phase.html</a></p>
</li>
<li><p><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/scroll.html" target="_blank" rel="noopener">https://www.elastic.co/guide/cn/elasticsearch/guide/current/scroll.html</a></p>
</li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jeffzzf.github.io/2018/12/22/分布式系统/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffzzf">
      <meta itemprop="description" content="Do one thing at a time, and do well.">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Noob">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/22/分布式系统/" class="post-title-link" itemprop="url">分布式系统</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-22 10:38:24" itemprop="dateCreated datePublished" datetime="2018-12-22T10:38:24+08:00">2018-12-22</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-28 20:23:34" itemprop="dateModified" datetime="2019-08-28T20:23:34+08:00">2019-08-28</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/分布式系统/" itemprop="url" rel="index"><span itemprop="name">分布式系统</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/分布式系统/概述/" itemprop="url" rel="index"><span itemprop="name">概述</span></a></span>

                
                
              
            </span>
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <p>分布式系统是一个硬件或软件组成分布在不同的网络计算机上，彼此之间仅仅通过消息传递进行通信和协调的系统。</p>
<p>分布式系统是一群独立计算机集合共同对外提供服务，对于系统的用户来说，像一台计算机在提供服务一样。分布式意味着可以采用更多的普通计算机（相对于昂贵的大型机）组成分布式集群对外提供服务。计算机越多，CPU、内存、存储资源等也就越多，能够处理的并发访问量也就越大。</p>
<p>分布式系统的各个主机之间通信和协调主要通过网络进行，计算机在空间上几乎没有任何限制，这些计算机可能被放在不同的机柜上，也可能被部署在不同的机房中，还可能在不同的城市中，对于大型的网站甚至可能分布在不同的国家和地区。</p>
<p>常用的分布式方案：</p>
<h3 id="1-分布式应用和服务"><a href="#1-分布式应用和服务" class="headerlink" title="1. 分布式应用和服务"></a>1. 分布式应用和服务</h3><p>将应用和服务进行分层或分割，并进行分布式部署。这样不仅可以突破单机性能瓶颈，提高并发访问能力，还能复用分布式部署的模块，使业务易于扩展。</p>
<h3 id="2-分布式静态资源"><a href="#2-分布式静态资源" class="headerlink" title="2. 分布式静态资源"></a>2. 分布式静态资源</h3><p>对JS、CSS、图片等资源进行分布式部署可以减轻服务器的压力，提高访问速度</p>
<h3 id="3-分布式数据和存储"><a href="#3-分布式数据和存储" class="headerlink" title="3. 分布式数据和存储"></a>3. 分布式数据和存储</h3><p>随着互联网应用需要存储越来越多的数据，单台机器往往无法提供足够的存储空间，需要对这些数据进行分布式存储。</p>
<h3 id="4-分布式计算"><a href="#4-分布式计算" class="headerlink" title="4. 分布式计算"></a>4. 分布式计算</h3><p>对于需要非常巨大的计算能力才能完成的任务，分布式计算将应用分解成许多小的部分，分配给多台计算机进行处理。这样可以节约计算时间，提高计算效率。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a href="初识分布式系统">http://www.hollischuang.com/archives/655</a></li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jeffzzf.github.io/2017/05/24/Linux进程管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffzzf">
      <meta itemprop="description" content="Do one thing at a time, and do well.">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Noob">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/05/24/Linux进程管理/" class="post-title-link" itemprop="url">Linux进程管理</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-05-24 14:11:56" itemprop="dateCreated datePublished" datetime="2017-05-24T14:11:56+08:00">2017-05-24</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-28 20:23:34" itemprop="dateModified" datetime="2019-08-28T20:23:34+08:00">2019-08-28</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span>

                
                
              
            </span>
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <blockquote>
<p>我们拥有操作系统就是为了运行用户程序，因此，进程管理是操作系统的心脏，Linux也不例外。</p>
</blockquote>
<h1 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h1><p>进程就是处于执行期的程序（目标代码存放在某种介质上）。但进程并不仅仅局限于一段可执行代码（Unix称其为代码段，text section），通常进程还包含其它资源，例如打开的文件、挂起的信号、内核内部的数据、处理器状态、一个或多个具有内存映射的内存地址空间及一个或多个执行线程（Thread of execution）等。实际上，进程是处于执行期程序以及相关资源的总称。可能存在两个或多个不同进程执行的是同一个程序。并且多个并存的进程还可以共享许多诸如打开的文件、地址空间之类的资源。<br>进程从创建它的时刻开始存活，在Linux系统中，通常通过fork()系统调用实现，该系统调用通过复制一个现有的进程来创建一个全新的进程。调用fork()的进程称为父进程，新产生的进程称为子进程。系统调用结束后，在返回点这个相同的位置，父进程恢复执行，子进程开始执行。fork()系统调用从内核返回两次，一次回到父进程，另一次回到新产生的子进程。</p>
<h1 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h1><p>执行线程，简称线程（Thread），是在进程中活动的对象。每个线程都有一个独立的程序计数器、进程栈和一组进程计数器。<strong>内核调度的对象是线程而不是进程</strong>。在传统的Unix系统中，一个进程只包含一个线程，但是对于现代操作系统来说，一个进程包含多个线程是非常常见的。Linux对进程和线程并不特别区分，线程只不过是一种特殊的进程。</p>
<p>在现代操作系统中，进程提供两种虚拟机制：<strong>虚拟处理器</strong>和<strong>虚拟内存</strong>。虽然实际上可能是许多进程正在分享一个处理器，但虚拟处理器给进程一种假象，让这些进程觉得自己在独享处理器。而虚拟内存让进程在分配和管理内存时觉得自己拥有整个系统的所有内存资源。同一进程的线程之间可以共享虚拟内存，但每个都拥有各自独立的虚拟处理器。</p>
<h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><p>《Linux内核设计与实现（第三版）》</p>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jeffzzf.github.io/2017/05/05/我为什么要写心理相关的文章？/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeffzzf">
      <meta itemprop="description" content="Do one thing at a time, and do well.">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Noob">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/05/05/我为什么要写心理相关的文章？/" class="post-title-link" itemprop="url">我为什么要写心理相关的文章？</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-05-05 15:25:11" itemprop="dateCreated datePublished" datetime="2017-05-05T15:25:11+08:00">2017-05-05</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-28 20:23:34" itemprop="dateModified" datetime="2019-08-28T20:23:34+08:00">2019-08-28</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/心理/" itemprop="url" rel="index"><span itemprop="name">心理</span></a></span>

                
                
              
            </span>
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <p>可能是因为自己心理经常经历痛苦、挣扎、抑郁，我一直对心理学保持关注。还记得大一那会儿，我一直担心自己得了抑郁症，从百度百科上面吧抑郁症词条以及和它相关的所有内容都打印出来，二三十页的A4打印纸打印了好几本。人处于痛苦中时，会本能地寻求解脱之道，心理学从那时起就是我的解药。一开始我只会去了解与自身密切相关的心理学知识，例如抑郁症的起因、症状、治疗方法等。但是慢慢的，我发现心理这件事越来越有意思了。人们的一言一行，一举一动，或喜极而泣，或怒不可遏……都是先在内心产生一定的化学反应，然后才有意或无意地表达出来的。至于一个人给其他人留下的或讨人欢喜或令人憎恶的深刻印象，则是长久以来某种心理活动频繁发生后形成的固化模式的自然表现，很多模式甚至可以追溯到童年和婴儿时期。</p>
<p>后来，我陆陆续续地从大学的心理学选修课、心理学讲座、TED等渠道零星地获取心理学的知识。先后读了《苏菲的世界》、《自卑与超越》、《走出抑郁症-一个抑郁症患者的成功自救》、《当下的力量》、《人性的优点》、《人性的弱点》。虽然不能算专业系统地学习，不过也从对心理学一无所知到现在乐在其中，从把心理学当做救命稻草到现在把心理学当做一种兴趣，在好奇心、求知欲的驱动下去去探索心理这个丰富多彩的世界，如果在旅程中刚好能解决自己的困惑和问题，就再好不过了。</p>
<p>机缘巧合，我在13年左右发现<a href="http://fm.xinli001.com/" target="_blank" rel="noopener">心理FM</a>，这个平台上有很多对心理感兴趣的小伙伴。好听的主播们会不定期地发布一些心理相关的节目，有名家名篇、有美文共赏、有答疑解惑。每当我情绪低落、痛苦迷茫，我都会打开心理FM。听到“世界和我爱着你”悲伤就治愈了一半。</p>
<p>回顾完我和心理学、心理FM的渊源，并没有正面回答为什么我想写一些心理相关的文章。</p>
<p>因为最近我越发觉得，“眼过千遍不如手过一遍”是非常有道理的。我是一个思维很发散的人，有时候甚至任由思绪信马由缰，脑海里经常有千头万绪、万马奔腾。有时候冒出一个Idea觉得前途远大，“卧槽，太牛X了，我怎么这么聪明”，有时候又觉得一件事困难重重，万难实现。但是如果减慢节奏，把大脑里的想法理一理，与现实结合起来。在纸上写写画画，或者用xmind画一幅脑图，就会发现大脑中的东西夹杂了太多个人的主观情绪和意愿。当现实的光线照进来，原来的东西会面目全非。</p>
<p>脱离现实太远的东西经常是病态的，写下来、画出来是想法联系现实的一种非常有效的方法。能在现实场中理清楚、说明白的就一定不会太过于臆想。</p>
<p>还有一种情况，在看书、看文章的时候，经常会觉得某个观点或某句话很有启发性，但是如果不记录下来，反复揣摩，并应用到生活和工作中，这些好东西也就仅限于给人带来启发性的感觉而已，并没有变成自己的东西。有一张图说明了人通过不同的渠道处理信息能够留存多少。<br><img src="http://qiniudns.zhhju.com/90a98144c7ba399f19f5aece2838327c_b.png" alt="信息留存图"></p>
<p>慢一点，把接触到的有触动、有启发的东西梳理一下，记录下来，并在实际生活工作中实践才能真正变成自己的东西。研究生毕业找工作的时候，身边很多人（包括我）看完《Thinking in Java》、《深入理解java虚拟机》、《Java并发编程实践》就以为掌握了其中的知识点，但在面试的时候面试官随便抽一个点出来问，都答不上来、讲不清楚。感觉自己看到过，但也只是看过，并没有真正吸收其中的精华，变成自己的东西。我们实验室一个小伙伴收割了无数Offer，几乎是手到擒来。后来告诉我诀窍：他看《Java并发编程实战》的时候，每看完一个知识点就就用自己的话重新表述一遍写下来。面试官问到的时候他因为自己揣摩过，能用自己的话把同样的意思表达清楚，自然就对答如流了。</p>
<p>总而言之，写心理相关的文章，首先是因为我确实认为心理学有意思、有价值；其次，通过写文章减慢大脑的运行节奏，让大脑中的想法与现实结合起来，不至于变成臆想；最后，只有能把想法表达出来、有条理地将给其他人听才算真正理解了，只有在现实中实践了才能真正发挥作用。</p>
<p>写这些文章（包括其它技术文章）的目的只是为了帮助自己更好地把握节奏，更好地理解和实践有价值的东西。可能有些内容只是别人内容的另一种表达甚至是同一种表达（当然我会尽量把参考资料列在文章的结尾），有些内容可能只是我自己的碎碎念。不过这不重要，在写下这些文章的过程中，我已经收获得足够多了。</p>
<p>##参考文档##<br><a href="https://www.zhihu.com/question/37757196" target="_blank" rel="noopener">工作五年以上的程序员，应该干些什么？</a></p>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jeffzzf</p>
  <div class="site-description motion-element" itemprop="description">Do one thing at a time, and do well.</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">121</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">60</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">107</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>



        </div>
      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jeffzzf</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.3.0</div>

        








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
      </div>

    

  </div>

  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  <script src="/js/utils.js?v=7.3.0"></script>
  <script src="/js/motion.js?v=7.3.0"></script>

  
  <script src="/js/schemes/muse.js?v=7.3.0"></script>


  

  <script src="/js/next-boot.js?v=7.3.0"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

  

  

  


  





  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
































</body>
</html>
